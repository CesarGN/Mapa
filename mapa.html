<!DOCTYPE html>
<html>
    <head>
        <meta  charset="utf-8">
        <link href="estilos.css" rel="stylesheet">
        <style>
            html, body, #capaMapa {
                margin: 0;
                padding: 0;
                height: 100%;
            }

            #panel {
                position: absolute;
                top: 5px;
                left: 50%;
                margin-left: -180px;
                z-index: 5;
                background-color: #fff;
                padding: 5px;
                border: 1px solid #999;
            }

        </style>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
        <style>
            input {
                border: 1px solid  rgba(0, 0, 0, 0.5);
            }
            input.notfound {
                border: 2px solid  rgba(255, 0, 0, 0.4);
            }
        </style>


        <script src="funciones.js"></script>

        <script>
            var directionsDisplay;
            //var directionsService;
            var stepDisplay;
            var markerArray = [];
            var map;
            var infowindow;
            var lat = 20.523056;
            var long = -100.813889;
            var directionsService = new google.maps.DirectionsService();


            function initialize() {

                //r
                directionsDisplay = new google.maps.DirectionsRenderer();

                var mapOptions = {
                    center: new google.maps.LatLng(lat, long),
                    zoom: 15,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                map = new google.maps.Map(document.getElementById('capaMapa'),
                        mapOptions);

                //r
                directionsDisplay.setMap(map);
                directionsDisplay.setPanel(document.getElementById('directions-panel'));


                var input = /** @type {HTMLInputElement} */(document.getElementById('searchTextField'));
                var autocomplete = new google.maps.places.Autocomplete(input);

                autocomplete.bindTo('bounds', map);

                infowindow = new google.maps.InfoWindow();
                var marker = new google.maps.Marker({
                    map: map

                });

                var request = {
                    location: new google.maps.LatLng(lat, long),
                    radius: 1000,
                    types: ['store']
                };


                google.maps.event.addListener(autocomplete, 'place_changed', function() {
                    infowindow.close();
                    marker.setVisible(false);
                    input.className = '';
                    var place = autocomplete.getPlace();
                    if (!place.geometry) {
                        // Inform the user that the place was not found and return.
                        input.className = 'notfound';
                        return;
                    }

                    // If the place has a geometry, then present it on a map.
                    if (place.geometry.viewport) {
                        map.fitBounds(place.geometry.viewport);
                    } else {
                        map.setCenter(place.geometry.location);
                        map.setZoom(17);  // Why 17? Because it looks good.
                    }
                    marker.setIcon(/** @type {google.maps.Icon} */({
                        url: place.icon,
                        size: new google.maps.Size(71, 71),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(17, 34),
                        scaledSize: new google.maps.Size(35, 35)
                    }));
                    var posicion = (place.geometry.location.toString());
                    posicion = (posicion.substring(1, posicion.length - 1));
                    document.getElementById('texto').innerHTML = (posicion.substring(1, posicion.length - 1));
                    var posic = posicion.split(",");
                    document.getElementById("latitud").value = (posic[0]);
                    document.getElementById("longitud").value = (posic[1]);
                    marker.setPosition(place.geometry.location);

                    marker.setVisible(true);

                    var address = '';
                    if (place.address_components) {
                        address = [
                            (place.address_components[0] && place.address_components[0].short_name || ''),
                            (place.address_components[1] && place.address_components[1].short_name || ''),
                            (place.address_components[2] && place.address_components[2].short_name || '')
                        ].join(' ');
                    }


                    infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
                    infowindow.open(map, marker);

                });

                // Sets a listener on a radio button to change the filter type on Places
                // Autocomplete.
                function setupClickListener(id, types) {
                    var radioButton = document.getElementById(id);
                    google.maps.event.addDomListener(radioButton, 'click', function() {
                        autocomplete.setTypes(types);
                    });
                }
                directionsDisplay.setMap(map);
                directionsDisplay.setPanel(document.getElementById('directions-panel'));


                setupClickListener('changetype-establishment', ['establishment']);
                setupClickListener('changetype-geocode', ['geocode']);
                var service = new google.maps.places.PlacesService(map);
                service.nearbySearch(request, callback);

            }





            //////////////////////////////////////////////////////////////

            function callback(results, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                    for (var i = 0; i < results.length; i++) {
                        createMarker(results[i]);
                    }
                }
            }

            function createMarker(place) {
                var placeLoc = place.geometry.location;
                var marker = new google.maps.Marker({
                    map: map,
                    position: place.geometry.location
                });

                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.setContent(place.name);
                    infowindow.open(map, this);
                });
            }

            function calcRoute() {
                var start = document.getElementById('start').value;
                var end = document.getElementById('end').value;
                var request = {
                    origin: start,
                    destination: end,
                    travelMode: google.maps.TravelMode.DRIVING
                };
                directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    }
                });
            }




            google.maps.event.addDomListener(window, 'load', initialize);


        </script>

    </head>
    <body>





        <div style="width: 100%; height: 500px;">

            <div id="capaMapa" style="float: left; width: 70%; height: 500px;" ></div>
            <div id="capapa" style="float: right; width: 30%; height: 500px; background-color: aliceblue; position: relative" >
                <input id="searchTextField" type="text" size="1000">

                <div>
                    <input type="radio" name="type" id="changetype-geocode" checked="checked">
                    <label for="changetype-geocode">Obtener Lugar</label>
                </div>
                <div>
                    <input type="radio" name="type" id="changetype-establishment">
                    <label for="changetype-establishment">Establecimiento</label>    
                </div> 



                <div id="control">
                    <strong>Origen: </strong>
                    <select id="start" onchange="calcRoute();">
                        <option value="Guerrero, México">Guerrero</option>
                        <option value="Guadalajara, México">Guadalajara</option>
                        <option value="Guanajuato, México">Guanajuato</option>
                        <option value="México">Mexico</option>
                        <option value="San Diego, California">San Diego</option>
                        <option value="Yucatán, México">Yucatan</option>
                        <option value="Chihuahua, México">Chihuahua</option>
                        <option value="Monterrey, México">Monterrey</option>
                        <option value="Querétaro, México">Querétaro</option>
                        <option value="Mazatlán, México">Mazatlán</option>
                        <option value="Puerto Vallarta, México">Puerto Vallarta</option>
                        <option value="Oaxaca, México">Oaxaca</option>
                    </select>
                    <strong>Destino: </strong>
                    <select id="end" onchange="calcRoute();">
                        <option value="Florida">Florida</option>
                        <option value="Texas">Texas</option>
                        <option value="Hidalgo, México">Hidalgo</option>
                        <option value="Los Mochis, México">Los Mochis</option>
                        <option value="Los Cabos, México">Los Cabos</option>
                        <option value="Celaya, México">Celaya</option>
                        <option value="Coyoacán, Ciudad de México, México">Coyoacán, Ciudad Mexico</option>
                        <option value="San Miguel de Allende, México">San Miguel de Allende</option>
                        <option value="Chicago, Illinois">Chicago, Illinois</option>
                        <option value="Guatemala">Guatemala</option>
                        <option value="Hermosillo, México">Hermosillo</option>
                        <option value="Manzanillo, México">Manzanillo</option>
                    </select>







                    <input type="text" id="latitud" value="20.523056"/> 
                    <input type="text" id="longitud" value="-100.813889"/>
                    <input type="button" value="Buscar Lugares Cercanos" onClick="buscarLugares()">
                    <div id="warnings_panel" style="width:100%;height:10%;text-align:center"></div>

                </div>

            </div>
            <div id="texto"></div>

            <div id="directions-panel"></div>




    </body>
</html>